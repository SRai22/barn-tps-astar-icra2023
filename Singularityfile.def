Bootstrap: docker
From: osrf/ros:noetic-desktop-full

%setup
    mkdir -p ${SINGULARITY_ROOTFS}/jackal_ws/src

%files
    . /jackal_ws/src/barn-tps-astar-icra2023

%runscript
    export DISPLAY=$DISPLAY
    export XAUTHORITY=$HOME/.Xauthority
    exec $@

%post -c /bin/bash
    dpkg --configure -a
    apt -y update && apt -y upgrade 
    apt-get install -y software-properties-common apt-utils
    apt-get install -y git cmake
    apt-get -y install python3 python3-venv
    python3 -m venv /venv
    export PATH="/venv/bin:$PATH"
    pip3 install --upgrade pip
    pip3 install empy defusedxml rospkg netifaces numpy 

    add-apt-repository ppa:joseluisblancoc/mrpt-stable
    apt -y update && apt -y upgrade
    apt install -y libmrpt-dev mrpt-apps

    cd /jackal_ws/src
    git clone https://github.com/jackal/jackal.git
    git clone https://github.com/jackal/jackal_simulator.git 
    git clone https://github.com/jackal/jackal_desktop.git 
    git clone https://github.com/utexas-bwi/eband_local_planner.git

    source /opt/ros/noetic/setup.bash
    cd .. 
    rosdep init; rosdep update;
    rosdep install -y --from-paths . --ignore-src --rosdistro=noetic
    apt-get install -y ros-noetic-marker-msgs ros-noetic-pos-cov-ops
    catkin_make 
    source devel/setup.bash

%environment
    export PATH="/venv/bin:$PATH"
    source /opt/ros/noetic/setup.bash
    source /jackal_ws/devel/setup.bash